---
title: "OSS License Comprehension Study"
output: html_notebook
---

# Read data

```{r}
library(dplyr)
library(clValid) # For Dunn's Index
library(dendextend)
userdata <- read.csv("OSSStudy6.csv", header=T)
userdata
```

# Eye Fixation data Clustering (MEL + LEL)

Groups:
[1] 1 3 4 5 9
[1] 2 6 7 8 10

```{r,}
df <- scale(dplyr::select(userdata, matches('melfix|lelfix|switches'), -matches('melm|lelm|mouse|mfix')))
colnames(df)
hc <- hclust(dist(df))
plot(hc)
groups <- cutree(hc,k =2)
groups <- cbind(userdata$ID, groups)
print(g1 <- groups[groups[,2] == 1,1])
print(g2 <- groups[groups[,2] == 2,1])
h <- heatmap(df, distfun = dist, hclustfun = hclust, scale="none")
```
# Eye Fixation data Clustering (MEL only)

Groups:
[1] 1 3 4 5 9
[1] 2 6 7 8 10

```{r,}
df <- scale(dplyr::select(userdata, matches('melfix|melswitches'), -matches('mouse|lel|mfix')))
colnames(df)
hc <- hclust(dist(df))
groups <- cutree(hc,k =2)
groups <- cbind(userdata$ID, groups)
print(g1 <- groups[groups[,2] == 1,1])
print(g2 <- groups[groups[,2] == 2,1])
h <- heatmap(df, distfun = dist, hclustfun = hclust, scale="none")
```
# Eye Fixation data Clustering (LEL only)

Groups:
[1] 1 2 3 4 5 9 10
[1] 6 7 8

```{r,}
df <- scale(dplyr::select(userdata, matches('lelfix|lelswitches'), -matches('mouse|mel|mfix')))
colnames(df)
hc <- hclust(dist(df))
groups <- cutree(hc,k =2)
groups <- cbind(userdata$ID, groups)
print(g1 <- groups[groups[,2] == 1,1])
print(g2 <- groups[groups[,2] == 2,1])
h <- heatmap(df, distfun = dist, hclustfun = hclust, scale="none")
```
# Mouse data Clustering (Mouse Data)

Groups:
[1] 1 2 3 4 5 9 10
[1] 6 7 8

```{r,}
df <- scale(dplyr::select(userdata, matches('melmouse|melm'), matches('lelmouse|lelm')))
colnames(df)
hc <- hclust(dist(df))
groups <- cutree(hc,k =2)
groups <- cbind(userdata$ID, groups)
print(g1 <- groups[groups[,2] == 1,1])
print(g2 <- groups[groups[,2] == 2,1])
h <- heatmap(df, distfun = dist, hclustfun = hclust, scale="none")
```
# Mouse data Clustering (MEL Mouse Data)

Groups:
[1] 1 3 4 5 7 8 9 10
[1] 2 6 

```{r,}
df <- scale(dplyr::select(userdata, matches('melmouse|melm')))
colnames(df)
hc <- hclust(dist(df))
groups <- cutree(hc,k =2)
groups <- cbind(userdata$ID, groups)
print(g1 <- groups[groups[,2] == 1,1])
print(g2 <- groups[groups[,2] == 2,1])
h <- heatmap(df, distfun = dist, hclustfun = hclust, scale="none")
```

# Mouse data Clustering (LEL Mouse Data)

Groups:
[1] 1 3 5 9
[1] 2 4 6 7 8 10

```{r,}
df <- scale(dplyr::select(userdata, matches('lelmouse|lelm')))
colnames(df)
hc <- hclust(dist(df))
groups <- cutree(hc,k =2)
groups <- cbind(userdata$ID, groups)
print(g1 <- groups[groups[,2] == 1,1])
print(g2 <- groups[groups[,2] == 2,1])
h <- heatmap(df, distfun = dist, hclustfun = hclust, scale="none")
```

# All User Interaction Data

Groups:
[1] 1 2 3 4 5 9 10
[1] 6 7 8

```{r}
df <- scale(dplyr::select(userdata, matches('melfix|lelfix|switches|melm|lelm')))
colnames(df)
Dist <- dist(df, method="euclidean")
hc <- hclust(Dist, method ="complete")
plot(hc)
groups <- cutree(hc,k =3)
dunn(Dist, groups)

avg_dend_obj <- as.dendrogram(hc)
avg_col_dend <- color_branches(avg_dend_obj, k = 3)
plot(avg_col_dend, ylab="Height", xlab="Participants")

```



```{r}
#Plot Feature Dendrogram
hc2 <- hclust(dist(t(df)))
avg_dend_obj <- as.dendrogram(hc2)
avg_col_dend <- color_branches(avg_dend_obj, k = 3)
plot(avg_col_dend,horiz=T, ylab="Height", xlab="Participants", asp = 0.5)

#Identify groups
groups <- cbind(userdata$ID, groups)
print(g1 <- groups[groups[,2] == 1,1])
print(g2 <- groups[groups[,2] == 2,1])
print(g3 <- groups[groups[,2] == 3,1])

#Heatmap
h <- heatmap(df, distfun = dist, hclustfun = hclust, scale="none")

```

# Convergent Validity with K-means

* Same clusters reported as hierarchical clustering

```{r}

#K-means Clustering
set.seed(20)
clusters <- kmeans(df, 3)
glimpse(clusters$cluster)
userdata$kgroup <- as.factor(clusters$cluster)

```

# Compute Composite Score and Assign numerical values to Confidence

```{r}

# Add computed columns to userdata
userdata <- userdata %>%
              mutate(learnability = SUS4 + SUS10,
                     usability = SUS1 + SUS2 + SUS3 + SUS5 + SUS6 + SUS7 + SUS8 + SUS9,
                     score = as.integer((melacc1 * ifelse(melconf1 == " h", 3, ifelse( melconf1 == " l", 2, 1)) +
                                melacc2 * ifelse(melconf2 == " h", 3, ifelse( melconf2 == " l", 2, 1)) +
                                lelacc1 * ifelse(lelconf1 == " h", 3, ifelse( lelconf1 == " l", 2, 1)) +
                                lelacc2 * ifelse(lelconf2 == " h", 3, ifelse( lelconf2 == " l", 2, 1)))/12*100),
                     conf = as.integer((ifelse(melconf1 == " h", 3, ifelse( melconf1 == " l", 2, 1)) +
                                ifelse(melconf2 == " h", 3, ifelse( melconf2 == " l", 2, 1)) +
                                ifelse(lelconf1 == " h", 3, ifelse( lelconf1 == " l", 2, 1)) +
                                ifelse(lelconf2 == " h", 3, ifelse( lelconf2 == " l", 2, 1)))/12*100),
                     rawscore = melacc1+melacc2+lelacc1+lelacc2)

# Add group as a factor
group <- as.factor(groups[,2])
userdata <- cbind(userdata, group)
glimpse(userdata)
```
#Dixon's test for outliers
* Source https://cran.r-project.org/web/packages/outliers/outliers.pdf 

```{r}
library("outliers")
shapiro.test(userdata$score)
plot(density(userdata$score))
dixon.test(userdata$score, type=10, opposite = T, two.sided = TRUE)

```


```{r}
# Test for composite score difference between two groups
userdata <- userdata[userdata$score != 0,]
boxplot(userdata$score~userdata$group, names = c("G1", "G2", "G3"), ylab = "Total Score")
kruskal.test(userdata$score~userdata$group) 
pairwise.wilcox.test(userdata$score, userdata$group, p.adjust.method = "BH")

# Test for raw score difference between two groups
boxplot(userdata$rawscore~userdata$group, names = c("G1", "G2", "G3"), ylab = "Raw Score")
kruskal.test(userdata$rawscore~userdata$group)
pairwise.wilcox.test(userdata$rawscore, userdata$group, p.adjust.method = "none") 

# Test for confidence difference between two groups
boxplot(userdata$conf~userdata$group, names = c("G1", "G2", "G3"), ylab = "Mean Confidence")
kruskal.test(userdata$conf~userdata$group)
pairwise.wilcox.test(userdata$conf, userdata$group, p.adjust.method = "none") 

```

# Eye tracking fixation count and duration differences between groups

* All differences significant!

```{r}

group1 <- userdata %>%
  filter (ID %in% g1)

group2 <- userdata %>%
  filter (ID %in% g2)

group3 <- userdata %>%
  filter (ID %in% g3)

# Test for eye fixation count difference between two groups
boxplot(rowMeans(dplyr::select(group1, matches('melfixcnt|lelfixcnt'))),
        rowMeans(dplyr::select(group2, matches('melfixcnt|lelfixcnt'))), 
        rowMeans(dplyr::select(group3, matches('melfixcnt|lelfixcnt'))), names = c("G1", "G2", "G3"), ylab = "Eye Fixation Count")

shapiro.test(rowMeans(dplyr::select(userdata, matches('melfixcnt|lelfixcnt')))) # distribution normal

t.test(rowMeans(dplyr::select(group1, matches('melfixcnt|lelfixcnt'))),
        rowMeans(dplyr::select(group2, matches('melfixcnt|lelfixcnt')))) # Significant difference

# Test for eye fixation duration difference between two groups

boxplot(rowMeans(dplyr::select(group1, matches('melfixdur|lelfixdur'))),
        rowMeans(dplyr::select(group2, matches('melfixdur|lelfixdur'))), names = c("G1", "G2"), ylab = "Eye Fixation Duration")

shapiro.test(rowMeans(dplyr::select(userdata, matches('melfixdur|lelfixdur')))) # distribution normal

t.test(rowMeans(dplyr::select(group1, matches('melfixdur|lelfixdur')),
        rowMeans(dplyr::select(group2, matches('melfixdur|lelfixdur'))))) # Very significant difference

```

# Mouse fixation count and duration differences between groups

* All differences significant!

```{r}

# Test for mouse fixation count difference between two groups

boxplot(rowMeans(dplyr::select(group1, matches('mousecnt'))),
        rowMeans(dplyr::select(group2, matches('mousecnt'))), names = c("G1", "G2"), ylab = "Mouse Fixation Count")

shapiro.test(rowMeans(dplyr::select(userdata, matches('mousecnt')))) # distribution normal
plot(density(rowMeans(dplyr::select(userdata, matches('mousecnt')))))

t.test(rowMeans(dplyr::select(group1, matches('mousecnt'))),
        rowMeans(dplyr::select(group2, matches('mousecnt')))) # Significant difference


# Test for mouse fixation duration difference between two groups

boxplot(rowMeans(dplyr::select(group1, matches('mfixdur'))),
        rowMeans(dplyr::select(group2, matches('mfixdur'), -matches('task'))), names = c("G1", "G2"), ylab = "Mouse Fixation Duration")

shapiro.test(rowMeans(dplyr::select(userdata, matches('mfixdur')))) # distribution ("barely") normal
plot(density(rowMeans(dplyr::select(userdata, matches('mfixdur')))))

t.test(rowMeans(dplyr::select(group1, matches('mfixdur'), -matches('task'))),
        rowMeans(dplyr::select(group2, matches('mfixdur'), -matches('task')))) # NO significant difference
```


# SUS and SUS subscales differences between groups

While no difference between the overall SUS score or Usability Subscale, the Learnability sub-scale shows a difference between the two groups.

* The group that performed poorly thought the interface was more learnable than the group that performed better.

```{r}
# Test for SUS difference between two groups
boxplot(group1$SUS, group2$SUS, names = c("Group1", "Group 2"), ylab = "Total SUS")
shapiro.test(userdata$SUS) # distribution normal
plot(density(userdata$SUS))
t.test(group1$SUS, group2$SUS) # Not Significant


# Test for SUS Learnability subscale difference between two groups
boxplot(group1$learnability, group2$learnability, names = c("Group1", "Group 2"), ylab = "Learnability (SUS)")
shapiro.test(userdata$learnability) # distribution not normal
plot(density(userdata$learnability))
wilcox.test(group1$learnability, group2$learnability) # Barely significant


# Test for SUS Usability subscale difference between two groups
boxplot(group1$usability, group2$usability, names = c("Group1", "Group 2"), ylab = "Usability (SUS)")
wilcox.test(group1$usability, group2$usability)

```
```{r}
#Eye Tracking Fixation Duration Hierarchy Means across groups
eDurHierarchyG1 <- mean(colMeans(dplyr::select(group1, matches('durhierachy'), -matches("mouse|cnt|mfix"))))
eDurHierarchyG2 <- mean(colMeans(dplyr::select(group2, matches('durhierachy'), -matches("mouse|cnt|mfix"))))

#Eye Tracking Fixation Count Hierarchy Means across groups
eCntHierarchyG1 <- mean(colMeans(dplyr::select(group1, matches('cnthierachy'), -matches("mouse"))))
eCntHierarchyG2 <- mean(colMeans(dplyr::select(group2, matches('cnthierachy'), -matches("mouse"))))

#Eye Tracking Fixation Duration Text Means across groups
eDurTextG1 <- mean(colMeans(dplyr::select(group1, matches('durtext'), -matches("mouse|mfix"))))
eDurTextG2 <- mean(colMeans(dplyr::select(group2, matches('durtext'), -matches("mouse|mfix"))))

#Eye Tracking Fixation Count Text Means across groups
eCntTextG1 <- mean(colMeans(dplyr::select(group1, matches('cnttext'), -matches("mouse|mfix"))))
eCntTextG2 <- mean(colMeans(dplyr::select(group2, matches('cnttext'), -matches("mouse|mfix"))))

#Eye Tracking Fixation Duration Model Means across groups
eDurModelG1 <- mean(colMeans(dplyr::select(group1, matches('durmodel'), -matches("mouse|mfix"))))
eDurModelG2 <- mean(colMeans(dplyr::select(group2, matches('durmodel'), -matches("mouse|mfix"))))

#Eye Tracking Fixation Count Model Means across groups
eCntModelG1 <- mean(colMeans(dplyr::select(group1, matches('cntmodel'), -matches("mouse|mfix"))))
eCntModelG2 <- mean(colMeans(dplyr::select(group2, matches('cntmodel'), -matches("mouse|mfix"))))

#Eye Tracking Fixation Duration Task Means across groups
eDurTaskG1 <- mean(colMeans(dplyr::select(group1, matches('durtask'), -matches("mouse|mfix"))))
eDurTaskG2 <- mean(colMeans(dplyr::select(group2, matches('durtask'), -matches("mouse|mfix"))))

#Eye Tracking Fixation Count task Means across groups
eCntTaskG1 <- mean(colMeans(dplyr::select(group1, matches('cnttask'), -matches("mouse|mfix"))))
eCntTaskG2 <- mean(colMeans(dplyr::select(group2, matches('cnttask'), -matches("mouse|mfix"))))

```

```{r}
#Mouse Tracking Fixation Duration Hierarchy Means across groups
mDurHierarchyG1 <- mean(colMeans(dplyr::select(group1, matches('melmfixdurhierachy|lelmfixdurhierachy'))))
mDurHierarchyG2 <- mean(colMeans(dplyr::select(group2, matches('melmfixdurhierachy|lelmfixdurhierachy'))))

#Mouse Tracking Fixation Count Hierarchy Means across groups
mCntHierarchyG1 <- mean(colMeans(dplyr::select(group1, matches('lelmousecnthierachy|melmousecnthierachy'))))
mCntHierarchyG2 <- mean(colMeans(dplyr::select(group2, matches('lelmousecnthierachy|melmousecnthierachy'))))

#Mouse Tracking Fixation Duration Text Means across groups
mDurTextG1 <- mean(colMeans(dplyr::select(group1, matches('melmfixdurtext|lelmfixdurtext'))))
mDurTextG2 <- mean(colMeans(dplyr::select(group2, matches('melmfixdurtext|lelmfixdurtext'))))

#Mouse Tracking Fixation Count Text Means across groups
mCntTextG1 <- mean(colMeans(dplyr::select(group1, matches('melmousecnttext|lelmousecnttext'))))
mCntTextG2 <- mean(colMeans(dplyr::select(group2, matches('melmousecnttext|lelmousecnttext'))))

#Mouse Tracking Fixation Duration Model Means across groups
mDurModelG1 <- mean(colMeans(dplyr::select(group1, matches('melmfixdurmodel|lelmfixdurmodel'))))
mDurModelG2 <- mean(colMeans(dplyr::select(group2, matches('melmfixdurmodel|lelmfixdurmodel'))))

#Mouse Tracking Fixation Count Model Means across groups
mCntModelG1 <- mean(colMeans(dplyr::select(group1, matches('melmousecntmodel|lelmousecntmodel'))))
mCntModelG2 <- mean(colMeans(dplyr::select(group2, matches('melmousecntmodel|lelmousecntmodel'))))

#Mouse Tracking Fixation Duration Task Means across groups
mDurTaskG1 <- mean(colMeans(dplyr::select(group1, matches('melmfixdurtask|lelmfixdurtask'))))
mDurTaskG2 <- mean(colMeans(dplyr::select(group2, matches('melmfixdurtask|lelmfixdurtask'))))

#Mouse Tracking Fixation Count Task Means across groups
mCntTaskG1 <- mean(colMeans(dplyr::select(group1, matches('melmousecnttask|lelmousecnttask'))))
mCntTaskG2 <- mean(colMeans(dplyr::select(group2, matches('melmousecnttask|lelmousecnttask'))))
```
```{r}
#Eye Tracking AOI switches means across Groups
eAOIswitchG1 <- median(colMeans(dplyr::select(group1, matches('lswitches'))))
eAOIswitchG2 <- median(colMeans(dplyr::select(group2, matches('lswitches'))))

#Eye Tracking AOI switches means across Groups
mAOIswitchG1 <- median(colMeans(dplyr::select(group1, matches('mswitches'))))
mAOIswitchG2 <- median(colMeans(dplyr::select(group2, matches('mswitches'))))

```


# Barplot comparing the two groups

* Eye and Mouse behavior shows a lot of similiarity. It may be possible to use one in liu of the other.
* Fixation duration is consistent across AOIs, however the counts are higher for model than text AOI.
    The model being graphical attracts more attention than text. 


```{r}

par(mfrow=c(3,2))
grpmean <- c(eDurHierarchyG1, eDurTextG1, eDurModelG1, eDurTaskG1)
grpmean <- rbind(grpmean, c(eDurHierarchyG2, eDurTextG2, eDurModelG2, eDurTaskG2))
barplot(grpmean, beside=T, names=c("Hierarchy", "Text", "Model", "Task"), ylab="Eye Fixation Duration")


grpmean <- c(eCntHierarchyG1, eCntTextG1, eCntModelG1, eCntTaskG1)
grpmean <- rbind(grpmean, c(eCntHierarchyG2, eCntTextG2, eCntModelG2, eCntTaskG2))
barplot(grpmean, beside=T, names=c("Hierarchy", "Text", "Model", "Task"), ylab="Eye Fixation Count")

grpmean <- c(mDurHierarchyG1, mDurTextG1, mDurModelG1, mDurTaskG1)
grpmean <- rbind(grpmean, c(mDurHierarchyG2, mDurTextG2, mDurModelG2, mDurTaskG2))
barplot(grpmean, beside=T, names=c("Hierarchy", "Text", "Model", "Task"), ylab="Mouse Fixation Dur.")

grpmean <- c(mCntHierarchyG1, mCntTextG1, mCntModelG1, mCntTaskG1)
grpmean <- rbind(grpmean, c(mCntHierarchyG2, mCntTextG2, mCntModelG2, mCntTaskG2))
barplot(grpmean, beside=T, names=c("Hierarchy", "Text", "Model", "Task"), ylab="Mouse Fixation Count")

grpmean <- c(eAOIswitchG1, mAOIswitchG1)
grpmean <- rbind(grpmean, c(eAOIswitchG2, mAOIswitchG2))
barplot(grpmean, beside=T, names=c("Eye", "Mouse"), ylab="Mean AOI Switches")

```